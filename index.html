<!DOCTYPE html>
<html lang="zh-TW" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>我的代購小幫手 (工業灰)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      body { font-family: "Segoe UI", Microsoft JhengHei, sans-serif; background-color: #18181b; color: #f4f4f5; }
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: #27272a; }
      ::-webkit-scrollbar-thumb { background: #52525b; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #71717a; }
      .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
      .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
  </head>
  <body>
    <div id="app" class="min-h-screen pb-10 bg-zinc-900 text-zinc-100">
      
      <transition name="fade">
        <div v-if="isInitializing" class="fixed inset-0 z-[9999] bg-zinc-900 flex flex-col items-center justify-center">
          <i class="fa-solid fa-circle-notch fa-spin text-6xl text-zinc-500 mb-4"></i>
          <p class="text-zinc-400 text-sm tracking-widest uppercase font-bold">Syncing Data...</p>
        </div>
      </transition>

      <nav class="bg-zinc-800 border-b border-zinc-700 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between h-16 items-center">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-box-open text-white text-2xl opacity-80"></i>
              <h1 class="text-xl font-bold text-white tracking-wide">代購紀錄</h1>
              <div class="flex items-center ml-4 space-x-3 border-l border-zinc-600 pl-4">
                <span v-if="isLoading" class="text-xs text-zinc-400 font-mono"><i class="fa-solid fa-spinner fa-spin mr-1"></i> LOADING...</span>
                <span v-if="isSaving" class="text-xs text-emerald-400 font-mono"><i class="fa-solid fa-floppy-disk fa-fade mr-1"></i> SAVING...</span>
              </div>
            </div>
            <button @click="openModal()" class="bg-zinc-100 hover:bg-white text-zinc-900 px-4 py-2 rounded text-sm font-bold transition shadow-md flex items-center">
              <i class="fa-solid fa-plus mr-1.5"></i> 新增紀錄
            </button>
          </div>
        </div>
      </nav>

      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
        <div class="bg-zinc-800 p-4 rounded-lg border border-zinc-700 flex flex-col sm:flex-row items-center justify-between gap-4 shadow-sm">
          
          <div class="flex items-center gap-3 w-full sm:w-auto">
            <label class="text-sm font-medium text-zinc-400 whitespace-nowrap">目前分頁:</label>
            <div class="relative flex-1 sm:flex-none">
              <select v-model="currentSheet" @change="changeSheet" class="appearance-none border border-zinc-600 rounded px-4 pr-10 py-2 text-sm focus:ring-1 focus:ring-white outline-none font-bold text-white bg-zinc-700 cursor-pointer hover:bg-zinc-600 transition w-full sm:w-48">
                <option v-for="name in sheetList" :key="name" :value="name">{{ name }}</option>
              </select>
              <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-zinc-400"><i class="fa-solid fa-chevron-down text-xs"></i></div>
            </div>
            <button @click="refreshAll()" class="bg-zinc-700 hover:bg-zinc-600 text-zinc-200 border border-zinc-600 px-3 py-2 rounded text-sm transition" title="重新讀取">
              <i class="fa-solid fa-rotate-right"></i>
            </button>
          </div>

          <div class="flex items-center gap-2 w-full sm:w-auto justify-end">
            <button @click="createNewSheet" class="text-zinc-400 hover:text-emerald-400 hover:bg-zinc-700 px-3 py-2 rounded text-sm transition border border-transparent hover:border-zinc-600 flex items-center">
              <i class="fa-solid fa-folder-plus mr-1.5"></i> 新分頁
            </button>
            <button @click="deleteCurrentSheet" class="text-zinc-500 hover:text-rose-400 hover:bg-zinc-700 px-3 py-2 rounded text-sm transition border border-transparent hover:border-zinc-600 flex items-center">
              <i class="fa-solid fa-trash-can mr-1.5"></i> 刪除
            </button>
          </div>
        </div>
      </div>

      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-6 grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-zinc-800 p-5 rounded-lg border border-zinc-700 relative overflow-hidden group shadow-sm">
          <div class="absolute top-0 left-0 w-1 h-full bg-zinc-500"></div>
          <div class="text-zinc-400 text-xs font-bold tracking-wider uppercase mb-1">Total Items</div>
          <div class="text-3xl font-mono font-bold text-white">{{ items.length }}<span class="text-sm text-zinc-500 ml-1">筆</span></div>
        </div>
        <div class="bg-zinc-800 p-5 rounded-lg border border-zinc-700 relative overflow-hidden shadow-sm">
          <div class="absolute top-0 left-0 w-1 h-full bg-emerald-600/80"></div>
          <div class="text-zinc-400 text-xs font-bold tracking-wider uppercase mb-1">已收款 (TWD)</div>
          <div class="text-3xl font-mono font-bold text-emerald-400">${{ formatNumber(totalPaid) }}</div>
        </div>
        <div class="bg-zinc-800 p-5 rounded-lg border border-zinc-700 relative overflow-hidden shadow-sm">
          <div class="absolute top-0 left-0 w-1 h-full bg-rose-600/80"></div>
          <div class="text-zinc-400 text-xs font-bold tracking-wider uppercase mb-1">未收款 (TWD)</div>
          <div class="text-3xl font-mono font-bold text-rose-400">${{ formatNumber(totalUnpaid) }}</div>
        </div>
      </div>

      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8 pb-20">
        <div class="mb-4">
          <div class="relative w-full sm:w-1/3">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-magnifying-glass text-zinc-400"></i></div>
            <input v-model="searchQuery" type="text" placeholder="搜尋代購項目..." class="w-full bg-zinc-800 border border-zinc-700 text-white placeholder-zinc-500 pl-10 p-2.5 rounded focus:ring-1 focus:ring-zinc-400 outline-none transition shadow-sm" />
          </div>
        </div>

        <div class="hidden md:block bg-zinc-800 rounded-lg border border-zinc-700 overflow-hidden shadow-sm">
          <table class="min-w-full divide-y divide-zinc-700">
            <thead class="bg-zinc-900">
              <tr>
                <th class="px-6 py-4 text-left text-xs font-medium text-zinc-400 uppercase tracking-wider">代購項目 / 商家</th>
                <th class="px-6 py-4 text-left text-xs font-medium text-zinc-400 uppercase tracking-wider">平台 / 匯率</th>
                <th class="px-6 py-4 text-left text-xs font-medium text-zinc-400 uppercase tracking-wider">金額試算</th>
                <th class="px-6 py-4 text-left text-xs font-medium text-zinc-400 uppercase tracking-wider">狀態 / 出貨</th>
                <th class="px-6 py-4 text-left text-xs font-medium text-zinc-400 uppercase tracking-wider">備註</th>
                <th class="px-6 py-4 text-right text-xs font-medium text-zinc-400 uppercase tracking-wider">操作</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-zinc-700">
              <tr v-for="item in filteredItems" :key="item.id" class="hover:bg-zinc-700/40 transition duration-150 group">
                <td class="px-6 py-4">
                  <div class="text-sm font-bold text-white">{{ item.name }}</div>
                  <div class="text-xs text-zinc-400 mt-1">{{ item.merchant }}</div>
                </td>
                <td class="px-6 py-4">
                  <div class="text-sm text-zinc-200">{{ item.platform }}</div>
                  <div class="text-xs text-zinc-500 mt-1 font-mono">{{ item.currency }} @ {{ item.rate }}</div>
                </td>
                <td class="px-6 py-4">
                  <div class="text-sm font-bold text-white font-mono">${{ formatNumber(calculateTotal(item)) }}</div>
                  <div class="text-xs text-zinc-500 mt-1 font-mono">{{ item.originalPrice }} × {{ item.quantity }}</div>
                </td>
                <td class="px-6 py-4">
                  <span :class="item.isPaid ? 'bg-emerald-900/60 text-emerald-300 border-emerald-800' : 'bg-rose-900/60 text-rose-300 border-rose-800'" class="px-2 py-0.5 inline-flex text-[10px] leading-5 font-bold uppercase tracking-wide rounded border">
                    {{ item.isPaid ? 'PAID' : 'UNPAID' }}
                  </span>
                  <div class="text-xs text-zinc-400 mt-1">{{ item.shippingDate || '--' }}</div>
                </td>
                <td class="px-6 py-4 text-sm text-zinc-300 max-w-xs truncate">{{ item.notes }}</td>
                <td class="px-6 py-4 text-right text-sm font-medium">
                  <button @click="editItem(item)" class="text-zinc-400 hover:text-white mr-4"><i class="fa-solid fa-pen"></i></button>
                  <button @click="deleteItem(item.id)" class="text-zinc-500 hover:text-rose-400"><i class="fa-solid fa-trash"></i></button>
                </td>
              </tr>
            </tbody>
          </table>
          <div v-if="filteredItems.length === 0" class="p-16 text-center text-zinc-500">
             <i class="fa-solid fa-inbox text-5xl mb-4 opacity-40"></i><p class="text-sm tracking-wide">NO DATA</p>
          </div>
        </div>

        <div class="md:hidden space-y-4">
          <div v-for="item in filteredItems" :key="item.id" class="bg-zinc-800 p-4 rounded border border-zinc-700 shadow-sm relative">
             <div class="flex justify-between items-start mb-3">
               <div>
                 <h3 class="font-bold text-white text-lg">{{ item.name }}</h3>
                 <p class="text-xs text-zinc-400 mt-1">{{ item.platform }} | {{ item.merchant }}</p>
               </div>
               <span :class="item.isPaid ? 'text-emerald-300 bg-emerald-900/60 border-emerald-800' : 'text-rose-300 bg-rose-900/60 border-rose-800'" class="px-2 py-1 text-[10px] font-bold border rounded">
                 {{ item.isPaid ? '已付款' : '未付款' }}
               </span>
             </div>
             <div class="grid grid-cols-2 gap-3 text-sm mb-4 bg-zinc-900 p-3 rounded border border-zinc-700">
               <div><span class="text-[10px] text-zinc-500 block uppercase font-bold">Original</span><span class="font-mono text-zinc-300">{{ item.originalPrice }} {{ item.currency }}</span></div>
               <div class="text-right"><span class="text-[10px] text-zinc-500 block uppercase font-bold">Total (TWD)</span><span class="font-mono font-bold text-white">${{ formatNumber(calculateTotal(item)) }}</span></div>
             </div>
             <div class="flex justify-end pt-2 gap-5 border-t border-zinc-700">
               <button @click="editItem(item)" class="text-zinc-400 hover:text-white text-sm">編輯</button>
               <button @click="deleteItem(item.id)" class="text-zinc-500 hover:text-rose-400 text-sm">刪除</button>
             </div>
          </div>
        </div>
      </div>

      <transition name="fade">
        <div v-if="showModal" class="fixed inset-0 z-50 overflow-y-auto">
          <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-zinc-900 bg-opacity-80 transition-opacity backdrop-blur-sm" @click="closeModal()"></div>
            <div class="inline-block align-bottom bg-zinc-800 rounded text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full border border-zinc-700">
              <div class="bg-zinc-800 px-6 pt-6 pb-6">
                <h3 class="text-xl font-bold text-white mb-6 border-l-4 border-zinc-200 pl-3">{{ isEditing ? '編輯項目' : '新增項目' }}</h3>
                <form @submit.prevent="saveItem" class="space-y-5">
                  <div class="grid grid-cols-2 gap-4">
                    <div><label class="block text-xs font-bold text-zinc-400 uppercase mb-1">代購項目</label><input v-model="form.name" required type="text" class="w-full bg-zinc-700 border border-zinc-600 rounded p-2 text-sm text-white focus:border-white outline-none" /></div>
                    <div><label class="block text-xs font-bold text-zinc-400 uppercase mb-1">平台</label><input v-model="form.platform" type="text" class="w-full bg-zinc-700 border border-zinc-600 rounded p-2 text-sm text-white focus:border-white outline-none" /></div>
                  </div>
                  <div class="grid grid-cols-2 gap-4">
                    <div><label class="block text-xs font-bold text-zinc-400 uppercase mb-1">商家</label><input v-model="form.merchant" type="text" class="w-full bg-zinc-700 border border-zinc-600 rounded p-2 text-sm text-white focus:border-white outline-none" /></div>
                    <div>
                      <label class="block text-xs font-bold text-zinc-400 uppercase mb-1">幣值</label>
                      <select v-model="form.currency" class="w-full bg-zinc-700 border border-zinc-600 rounded p-2 text-sm text-white focus:border-white outline-none">
                        <option value="JPY">JPY 日幣</option><option value="USD">USD 美金</option><option value="CNY">CNY 人民幣</option><option value="TWD">TWD 台幣</option><option value="KRW">KRW 韓元</option>
                      </select>
                    </div>
                  </div>
                  <div class="bg-zinc-900 p-4 rounded border border-zinc-700">
                    <div class="grid grid-cols-3 gap-3">
                      <div><label class="block text-[10px] font-bold text-zinc-500 uppercase mb-1">單價</label><input v-model.number="form.originalPrice" type="number" step="0.01" class="w-full bg-zinc-800 border border-zinc-600 rounded p-1.5 text-sm text-white focus:border-white outline-none" /></div>
                      <div><label class="block text-[10px] font-bold text-zinc-500 uppercase mb-1">數量</label><input v-model.number="form.quantity" type="number" class="w-full bg-zinc-800 border border-zinc-600 rounded p-1.5 text-sm text-white focus:border-white outline-none" /></div>
                      <div><label class="block text-[10px] font-bold text-zinc-500 uppercase mb-1">匯率</label><input v-model.number="form.rate" type="number" step="0.0001" class="w-full bg-zinc-800 border border-zinc-600 rounded p-1.5 text-sm text-white focus:border-white outline-none" /></div>
                    </div>
                    <div class="mt-3 text-right flex justify-end items-baseline gap-2">
                       <span class="text-xs text-zinc-500">Total:</span><span class="text-xl font-bold text-white font-mono">${{ formatNumber(Math.round(form.originalPrice * form.quantity * form.rate)) }}</span>
                    </div>
                  </div>
                  <div class="grid grid-cols-2 gap-4">
                    <div><label class="block text-xs font-bold text-zinc-400 uppercase mb-1">出貨日</label><input v-model="form.shippingDate" type="date" class="w-full bg-zinc-700 border border-zinc-600 rounded p-2 text-sm text-white focus:border-white outline-none [color-scheme:dark]" /></div>
                    <div><label class="block text-xs font-bold text-zinc-400 uppercase mb-1">收款方式</label><input v-model="form.paymentMethod" type="text" list="methods" class="w-full bg-zinc-700 border border-zinc-600 rounded p-2 text-sm text-white focus:border-white outline-none" /><datalist id="methods"><option value="轉帳" /><option value="LinePay" /><option value="現金" /></datalist></div>
                  </div>
                  <div class="flex items-center mt-2 bg-zinc-700/50 p-3 rounded cursor-pointer border border-transparent hover:border-zinc-600 transition" @click="form.isPaid = !form.isPaid">
                    <div class="relative flex items-center">
                      <input id="paid" v-model="form.isPaid" type="checkbox" class="peer h-5 w-5 cursor-pointer appearance-none rounded border border-zinc-500 bg-zinc-800 checked:border-white checked:bg-white transition-all" />
                      <i class="fa-solid fa-check text-black absolute left-1 top-1 text-xs opacity-0 peer-checked:opacity-100 pointer-events-none"></i>
                    </div>
                    <label for="paid" class="ml-3 block text-sm font-bold text-white cursor-pointer select-none">標記為已付款 (Paid)</label>
                  </div>
                  <div><label class="block text-xs font-bold text-zinc-400 uppercase mb-1">備註</label><textarea v-model="form.notes" rows="2" class="w-full bg-zinc-700 border border-zinc-600 rounded p-2 text-sm text-white focus:border-white outline-none"></textarea></div>
                  <div class="pt-4 flex justify-end gap-3 border-t border-zinc-700 mt-2">
                    <button type="button" @click="closeModal()" class="bg-transparent hover:bg-zinc-700 text-zinc-300 py-2 px-4 rounded text-sm font-bold transition">取消</button>
                    <button type="submit" class="bg-zinc-100 hover:bg-white text-black py-2 px-6 rounded text-sm font-bold shadow-lg transition">儲存變更</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </transition>
    </div>

    <script>
      const { createApp, ref, computed, onMounted } = Vue;

      createApp({
        setup() {
          // ★ 請確保這是你最新的 Apps Script 網址 (mfr 密碼版)
          const API_URL = "https://script.google.com/macros/s/AKfycbw-0HUE3onUx_mMHa8JCEFkdXQAUArFBtu9EZFmk3qMQAqydnB5e-6CHGPbk0rFyYpbyA/exec";

          const items = ref([]);
          const searchQuery = ref("");
          const isLoading = ref(false);
          const isSaving = ref(false);
          const isInitializing = ref(true);
          const showModal = ref(false);
          const isEditing = ref(false);
          const currentId = ref(null);

          // 分頁狀態
          const currentSheet = ref(""); // 對應 HTML 的 v-model
          const sheetList = ref([]);

          const defaultForm = {
            name: "", platform: "", merchant: "", currency: "JPY",
            originalPrice: 0, quantity: 1, rate: 0.23,
            isPaid: false, shippingDate: "", paymentMethod: "", notes: "",
          };
          const form = ref({ ...defaultForm });

          const getPassword = () => {
            let pwd = localStorage.getItem("my_app_password");
            if (!pwd) {
              pwd = prompt("請輸入管理員密碼：");
              if (pwd) localStorage.setItem("my_app_password", pwd);
            }
            return pwd;
          };

          // 1. 取得分頁列表
          const fetchSheetList = async () => {
            const cachedList = localStorage.getItem("cached_sheet_list");
            if (cachedList) {
              sheetList.value = JSON.parse(cachedList);
              if (!currentSheet.value && sheetList.value.length > 0) {
                currentSheet.value = sheetList.value[0];
              }
            }
            try {
              const res = await fetch(`${API_URL}?action=get_sheets`);
              const list = await res.json();
              if (Array.isArray(list)) {
                sheetList.value = list;
                localStorage.setItem("cached_sheet_list", JSON.stringify(list));
                if (!currentSheet.value || !list.includes(currentSheet.value)) {
                  if (list.length > 0) currentSheet.value = list[0];
                }
              }
            } catch (e) {
              console.error("無法取得分頁清單", e);
            }
          };

          // 2. 讀取特定分頁資料
          const fetchData = async () => {
            if (!currentSheet.value) return;
            isLoading.value = true;
            items.value = [];
            try {
              const url = `${API_URL}?sheetName=${encodeURIComponent(currentSheet.value)}`;
              const res = await fetch(url);
              const data = await res.json();

              if (data.error) {
                console.warn(data.error);
                if (data.sheetList) sheetList.value = data.sheetList;
              } else {
                items.value = data.map((i) => ({ ...i, isPaid: Boolean(i.isPaid) }));
              }
            } catch (error) {
              console.error(error);
              alert("讀取失敗");
            } finally {
              isLoading.value = false;
            }
          };

          // 切換分頁時
          const changeSheet = () => {
             fetchData();
          };

          // 重新整理
          const refreshAll = async () => {
             isInitializing.value = true;
             await fetchSheetList();
             await fetchData();
             isInitializing.value = false;
          };

          // 通用 API 發送
          const sendCommand = async (action, extraData = {}) => {
            const userPassword = getPassword();
            if (!userPassword) return false;

            isSaving.value = true;
            try {
              const payload = {
                auth: userPassword,
                action: action,
                sheetName: currentSheet.value,
                ...extraData,
              };
              const res = await fetch(API_URL, { method: "POST", body: JSON.stringify(payload) });
              const result = await res.json();
              if (result.status === "error") {
                alert(result.message);
                if (result.message.includes("密碼")) localStorage.removeItem("my_app_password");
                return false;
              }
              return true;
            } catch (e) {
              alert("操作失敗");
              return false;
            } finally {
              isSaving.value = false;
            }
          };

          // 3. 儲存
          const saveItem = async () => {
            if (isEditing.value) {
              const idx = items.value.findIndex((i) => i.id === currentId.value);
              if (idx !== -1) items.value[idx] = { ...form.value, id: currentId.value };
            } else {
              items.value.unshift({ ...form.value, id: Date.now() });
            }
            closeModal();
            await sendCommand("save", { data: items.value });
          };

          // 4. 刪除
          const deleteItem = async (id) => {
            if (confirm("刪除此項目？")) {
              items.value = items.value.filter((i) => i.id !== id);
              await sendCommand("save", { data: items.value });
            }
          };

          // 5. 建立新分頁
          const createNewSheet = async () => {
            const newName = prompt("請輸入新分頁名稱 (例如: 2024-06)：");
            if (!newName) return;
            if (sheetList.value.includes(newName)) {
              alert("分頁已存在，直接切換");
              currentSheet.value = newName;
              fetchData();
              return;
            }
            const success = await sendCommand("create_sheet", { sheetName: newName });
            if (success) {
              alert("分頁建立成功！");
              items.value = [];
              await fetchSheetList();
              currentSheet.value = newName;
            }
          };

          // 6. 刪除目前分頁
          const deleteCurrentSheet = async () => {
            if (sheetList.value.length <= 1) { alert("至少保留一個分頁"); return; }
            if (!confirm(`確定要刪除「${currentSheet.value}」嗎？`)) return;
            const success = await sendCommand("delete_sheet");
            if (success) {
              alert("分頁已刪除");
              await fetchSheetList();
              if (sheetList.value.length > 0) {
                currentSheet.value = sheetList.value[0];
                fetchData();
              }
            }
          };

          onMounted(async () => {
            isInitializing.value = true;
            await fetchSheetList();
            await fetchData();
            isInitializing.value = false;
          });

          // Helpers
          const calculateTotal = (i) => Math.round(i.originalPrice * i.quantity * i.rate);
          const formatNumber = (n) => n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
          const totalPaid = computed(() => items.value.filter((i) => i.isPaid).reduce((s, i) => s + calculateTotal(i), 0));
          const totalUnpaid = computed(() => items.value.filter((i) => !i.isPaid).reduce((s, i) => s + calculateTotal(i), 0));
          const filteredItems = computed(() => {
            if (!searchQuery.value) return items.value;
            const q = searchQuery.value.toLowerCase();
            return items.value.filter((i) => i.name.toLowerCase().includes(q) || (i.merchant && i.merchant.toLowerCase().includes(q)));
          });
          const openModal = () => { isEditing.value = false; form.value = { ...defaultForm }; showModal.value = true; };
          const editItem = (item) => { isEditing.value = true; currentId.value = item.id; form.value = JSON.parse(JSON.stringify(item)); showModal.value = true; };
          const closeModal = () => (showModal.value = false);

          return {
            items, searchQuery, isLoading, isSaving, showModal, isEditing, form,
            sheetList, currentSheet, // 變數名稱修正
            fetchSheetList, fetchData, createNewSheet, deleteCurrentSheet,
            changeSheet, refreshAll, // 補上函式
            filteredItems, totalPaid, totalUnpaid,
            openModal, closeModal, saveItem, editItem, deleteItem,
            calculateTotal, formatNumber, is
